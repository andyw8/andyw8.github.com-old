
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Cucumber, BDD and London 2012 - Andy Waite</title>
  <meta name="author" content="Andy Waite">
  <meta name="Generator" content="Jekyll & Octopress (http://octopress.org)">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://andyw8.github.com/2012/08/20/cucumber-bdd-london-2012/">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/octopress.min.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Andy Waite" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12241830-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


   
  <link href="/octopress-favicon.png" rel="icon">
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Andy Waite</a></h1>
  
    <h2>Ruby and iOS Developer in London</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:andyw8.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="/hire-me">Hire Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>











<article class="hentry " role="article">
  
  <header>
    <h1 class="entry-title">

Cucumber, BDD and London 2012

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-08-20T19:54:00+01:00" pubdate data-updated="true">Aug 20<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/08/20/cucumber-bdd-london-2012/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>I recently finished a contract with BBC Future Media working on the <a href="http://www.bbc.co.uk/sport/0/olympics/2012/">London 2012 Olympics coverage</a>. I was part of the <a href="http://www.bbc.co.uk/blogs/bbcinternet/2012/03/sport_olympic_service_update.html">Sports Olympic Service team</a> which published pages for each athlete, country, discipline, event and venue as well as the medal tables.</p>

<p>My role was as a Developer-in-Test, in which I used my coding background to  build quality into the end product using techniques such as Specification by Example, Continuous Integration and Behaviour-Driven Development.</p>

<p>This post describes how we made use of Ruby, Cucumber and some other tools in our approach. (I have simplfied some aspects for the sake of readability and conciseness).</p>

<h2>Architecture Overview</h2>

<p>The BBC Forge platform uses PHP and Zend at the front-end and connects to a number of back-end services over HTTP. For the Olympics coverage, some data was provided by a third-party as a REST API serving XML responses.</p>

<p>A major challenge was that the third-party APIs had not yet been built. We were given examples of what to expect in the responses but our development would have to be done in parallel with the third-party&#8217;s own development.</p>

<h2>Requirements Analysis</h2>

<p>We wrote specifications using the Gherkin format, keeping in mind <a href="http://www.amazon.co.uk/gp/product/0321205685">Mike Cohn&#8217;s INVEST guidelines</a> which say stories should be:</p>

<ul>
<li>Independent</li>
<li>Negotiable</li>
<li>Valuable</li>
<li>Estimable</li>
<li>Small</li>
<li>Testable</li>
</ul>


<p>As an example, consider the story for the medals table. There are <a href="http://en.wikipedia.org/wiki/Olympic_medal_table">very particular rules</a> for the correct order to list the countries in the medals table. Working with developers and business analysts, we came up with the following acceptance criteria:</p>

<pre><code>Feature: Medals Table
  Countries are ranked by the number of golds, silvers,
  then bronzes, followed by their official IOC code.

  Scenario: No medals
    Given no medals have been awarded
    When I view the medals table
    Then a placeholder message should be present

  Scenario: Same number of gold
    Given the medals:
      | country       | gold |
      | United States | 3    |
      | China         | 1    |     
      | Great Britain | 2    |
    When I view the medals table
    Then the ranking should be United States, Great Britain, China

  Scenario: Same number of gold but different number of silver
    Given the medals:
      | country       | gold | silver |
      | United States | 2    | 3      |
      | China         | 2    | 1      |
      | Great Britain | 2    | 2      |
    When I view the medals table
    Then the ranking should be United States, Great Britain, China

  Scenario: Same number of gold and silver but different number of bronze
    Given the medals:
      | country       | gold | silver | bronze |
      | United States | 2    | 2      | 3      |
      | China         | 2    | 2      | 1      |
      | Great Britain | 2    | 2      | 2      |
    When I view the medals table
    Then the ranking should be United States, Great Britain, China

  Scenario: Same number of gold, silver and bronze
    Given the United States, China and Great Britain have equal gold, silver and bronze 
    When I view the medals table
    Then the ranking should be China, Great Britain, United States
</code></pre>

<p>(The <a href="http://en.wikipedia.org/wiki/List_of_IOC_country_codes">IOC code</a> is a three-letter acronym such as USA or GBR)</p>

<p>Our data provider supplied examples of the XML format which looked something like this:</p>

<pre><code>&lt;countries&gt;
  &lt;country name="United States" code="USA" gold="1" silver="2" bronze="3" /&gt;
  &lt;country name="Great Britain" code="GBR" gold="1" silver="2" bronze="3" /&gt;
&lt;/countries&gt;
</code></pre>

<p>So in order to test all five scenarios above, a different XML fixture would be needed for each one. Creating these by hand would be time-consuming, and most of the feeds were more complex than this example. Additionally, the XML structure was subject to change, which would also add to the maintenance burden.</p>

<p>So to automate this, I built a template with placeholders which could be populated with the appropriate data for each scenario.</p>

<p>I chose to use the <a href="http://liquidmarkup.org/">Liquid</a> templating library as the curly braces stand out from the surrounding XML, but there are numerous other viable choices. Converted into a Liquid template, the XML example above would look something like:</p>

<pre><code>&lt;countries&gt;
  \{% for country in countries %\}
  &lt;country name="{{ country.name }}" code="{{ country.code }}" gold="{{ country.gold }}" silver="{{ country.silver }}" bronze="{{ country.bronze }}" /&gt;
  \{% endfor %\}
&lt;/countries&gt;
</code></pre>

<p>(excuse the additional backslashes, I had trouble getting Octopress to display this correctly)</p>

<p>So then, the required fixtures could be generated using code such as:</p>

<pre><code>Liquid::Template.parse(template).render 'countries' =&gt; [
  { name: 'United States',
    code: 'USA',
    gold: 1
    silver: 2,
    bronze: 3 },
  { name: 'Great Britain',
    code: 'GBR',
    gold: 1
    silver: 2,
    bronze: 3 } ]
</code></pre>

<p>The next challenge was how to run tests against these fixtures. As the site isn&#8217;t built in Ruby, stubbing the HTTP classes wasn&#8217;t an option. Instead, I used <a href="http://artemave.github.com/2012/05/27/stub-like-a-surgeon-spy-like-james-bond-with-rest-assured/">REST-Assured</a>, a highly-useful testing tool built by another BBC contractor <a href="http://artemave.github.com/">Artem Avetisyan</a>.</p>

<p>REST-Assured has a simple API which defines that a particular query string should give a specified response:</p>

<pre><code>Given /^there no medals have been awarded "([^"])*"$/ do |query|
  xml = Liquid::Template.parse(template).render 'countries' =&gt; []
  RestAssured::Double.create
    fullpath: "/medals",
    content: xml
end
</code></pre>

<p>We ran REST-Assured on Heroku for convenience. For the testing environment, we added a hook so that a the API endpoint configuration could be overridden using a query string parameter, e.g. http://test.bbc.co.uk/olympics/medals?host=bbc382981.herokuapp.com</p>

<p>These Cucumber scenarios formed part of our continous integration builds running on Hudson, helping to make the BBC&#8217;s London 2012 coverage <a href="http://www.bbc.co.uk/blogs/bbcinternet/2012/08/digital_olympics_reach_stream_stats.html">a great success</a>.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Andy Waite</span></span>










  


<time datetime="2012-08-20T19:54:00+01:00" pubdate data-updated="true">Aug 20<span>th</span>, 2012</time>


<span class="categories">
  
    <a class='category' href='/blog/categories/bdd/'>bdd</a>, <a class='category' href='/blog/categories/cucumber/'>cucumber</a>
  
</span>



      

    </p>
    
      <div class="sharing">
  
    
      <a href="http://twitter.com/share" title="Tweet this" class="twitter-share" target="_blank">Tweet</a>
    
  
  
  
  

</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/2012/08/08/how-to-easily-delete-a-large-amazon-s3-bucket/" title="Previous Post: How to easily delete a large Amazon S3 Bucket">&laquo; How to easily delete a large Amazon S3 Bucket</a>
      
      
    </p>
  </footer>
</article>

<section>
  <h1>Comments</h1>
  

  
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  
</section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2012/08/20/cucumber-bdd-london-2012/">Cucumber, BDD and London 2012</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/08/how-to-easily-delete-a-large-amazon-s3-bucket/">How to easily delete a large Amazon S3 Bucket</a>
      </li>
    
      <li class="post">
        <a href="/2012/05/28/rubymotion-app-template/">RubyMotion App Template</a>
      </li>
    
      <li class="post">
        <a href="/2012/04/18/first-post-with-octopress/">First Post With Octopress</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets" data-user="andyw8" data-count="4" data-replies="false">
    <li class="loading">Status updating...</li>
  </ul>
  
    <a href="//twitter.com/andyw8" class="twitter-follow-button" data-show-count="false">Follow @andyw8</a>
  
</section>










  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Andy Waite -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'andywaite';
			var disqus_developer = '0';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://andyw8.github.com/2012/08/20/cucumber-bdd-london-2012/';
        var disqus_url = 'http://andyw8.github.com/2012/08/20/cucumber-bdd-london-2012/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






</body>
</html>
