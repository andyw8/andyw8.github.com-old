
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Andy Waite</title>
  <meta name="author" content="Andy Waite">
  <meta name="Generator" content="Jekyll & Octopress (http://octopress.org)">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://andyw8.github.com/">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/octopress.min.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Andy Waite" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-12241830-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


   
  <link href="/octopress-favicon.png" rel="icon">
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Andy Waite</a></h1>
  
    <h2>Contract Ruby, Rails and iOS Developer in London</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:andyw8.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/archives">Archives</a></li>
  <li><a href="/hire-me">Hire Me</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2013/11/20/tablexi/">TableXI Chicago</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2013-11-20T20:04:00-06:00" pubdate data-updated="true">Nov 20<span>th</span>, 2013</time>
         &bull; <a rel="bookmark" href="/2013/11/20/tablexi/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>TableXI are based in a large loft-style office in the West Loop area of Chicago. The place has lots of nice touches highlighting the history and culture of the company, such as the recreation of their logo using just pins and string:</p>

<p><img src="https://dl-web.dropbox.com/get/BlogImages/TableXI/pins.jpg?w=AAAysEbiPvEabSEl-s4KyjhIV8clL_aFY40PuMhMsI39Og" alt="Logo" /></p>

<p>The coolest time to visit must be summer, when they run their own rooftop cinema on top the building!</p>

<p>The office design includes a professional kitchen. A chef cooks the team lunch each day, which encourages everyone to spend time together.</p>

<p><img src="https://dl-web.dropbox.com/get/BlogImages/TableXI/kitchen.jpg?w=AACvAn_ix7yuhlxacGMFeENesmzPuaQQba-GrkCAUWiWGg" alt="Kitchen" /></p>

<p>They&#8217;re very supportive of the Chicago software development community, and sponsor or host many events:</p>

<p><img src="https://dl-web.dropbox.com/get/BlogImages/TableXI/board.jpg?w=AADunPczjA55cqd2aamETK-k81ucbikUS3KDbQoEVNV9Pg" alt="Chalkboard" /></p>

<p>The often have guests working in the office, so today I was grateful to pair with <a href="http://twitter.com/theotherzach">Zack Briggs</a> of TestDouble. He was working on a Chrome plugin using Angular.js for measuring JavaScript performance.</p>

<p>Below is a bunch of miscelleanous notes, observations and links from today:</p>

<ul>
<li><a href="http://www.amazon.com/dp/B0083I7Y8W">Logitech Conference Cam</a></li>
<li><a href="http://lodash.com/">Lo-Dash</a> is a Backbone.js replacement, with benefits including faster performance</li>
<li>Backbone tends to be significantly slower than Angular or Ember - you can see this on the <a href="http://todomvc.com/">TodoMVC</a> site after adding about 30 items.</li>
<li>Angular&#8217;s use of additional attributes may feel awkward at first, but it means there&#8217;s almost never a need to add IDs or classes solely for behaviour</li>
<li>Angular&#8217;s <code>ng-repeat</code> makes dealing with collections much cleaner than using subviews</li>
<li>The pipe character (|) is slightly odd at first - <a href="http://stackoverflow.com/questions/15223447/syntax-for-ng-repeat-angular-directive-and-pipe-character">StackOverflow post</a></li>
<li><a href="http://backbonejs.org/docs/backbone.html">Backbone.js has nicely annoted source</a></li>
<li>NPM solves the problem of competing dependencies by having multiple copies of a dependant library. Rather different from RubyGems.</li>
<li>Sometimes code can be &#8220;so DRY that it&#8217;s chafing&#8221;</li>
<li><a href="http://devbootcamp.com/">Dev Bootcamp</a></li>
<li><a href="http://stackoverflow.com/questions/16823746/backbone-js-listento-vs-on">Backbone.js: .listenTo vs .on</a> to avoid phantom views</li>
<li><a href="https://www.google.com/intl/en/chrome/browser/canary.html">Chrome Canary</a> can be a useful sandbox if you&#8217;re building an extension and don&#8217;t want to mess up your main browser</li>
<li><a href="http://www.alfredapp.com/">Alfred</a>, an alternative to QuickSilver, LaunchBar, etc.</li>
<li><a href="http://livereload.com/">LiveReload</a></li>
<li><a href="http://www.youtube.com/watch?v=yuh9COzp5vo">An Intervention for ActiveRecord</a></li>
<li>Some recommended Destroy All Software episodes covering VIM and shell: <a href="https://www.destroyallsoftware.com/screencasts/catalog/processes-and-jobs">Processes and Jobs</a>, <a href="https://www.destroyallsoftware.com/screencasts/catalog/file-navigation-in-vim">File Navigation in Vim</a>, <a href="https://www.destroyallsoftware.com/screencasts/catalog/the-vimrc">The .vimrc</a></li>
<li>All the Vim you need to get started and be productive can easily fit on an index card</li>
<li>I knew some of the common Bash keyboard shortcuts, but I never realised they were inspired by emacs. You can also set bash to use vi mode.</li>
<li><a href="http://www.confreaks.com/videos/364-gogaruco2010-workflow">Golden Gate Ruby Conference 2010 - Workflow - Ryan Davis</a></li>
<li><a href="http://www.confreaks.com/videos/2427-railsconf2013-nobody-will-train-you-but-you">Nobody will train you but you</a> - Zack&#8217;s talk from RailsConf 2013</li>
<li><a href="https://github.com/robbyrussell/oh-my-zsh">Oh My ZSH</a></li>
<li>Consider setting your shell prompt to indicate a dirty index or untracked files (see <a href="http://stackoverflow.com/questions/2657935/checking-for-a-dirty-index-or-untracked-files-with-git">this StackOverflow post</a>)</li>
<li>When you set a breakpoint in JavaScript, you can hover over variables to see their current state</li>
<li>When your pair with someone, you often learn more about improving your workflow than improving your coding</li>
</ul>

</div>

  <footer>
    
    <p><a class="comments-link" href="/2013/11/20/tablexi/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2013/11/02/thoughtbot-boston/">Thoughtbot, Boston</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2013-11-02T07:39:00-05:00" pubdate data-updated="true">Nov 2<span>nd</span>, 2013</time>
         &bull; <a rel="bookmark" href="/2013/11/02/thoughtbot-boston/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>Thoughtbot&#8217;s office is next to the scenic <a href="http://en.wikipedia.org/wiki/Boston_Common">Boston Common</a>, and was just a short walk from my hotel.</p>

<p>I first met with Anna, Thoughtbot&#8217;s office manager, who gave me quick tour and introduced me to <a href="https://twitter.com/joshuaclayton">Josh Clayton</a>, one of Thoughtbot&#8217;s managing directors. Coincidentally I&#8217;d just heard Josh speaking on the <a href="http://podcasts.thoughtbot.com/giantrobots">Giant Robots podcast</a> while I was on the flight over.</p>

<p>Josh had been working on a feature for <a href="http://github.com/thoughtbot/factory_girl">factory_girl</a>, a testing library which I was already familiar with. The <code>create_list</code> method can sometimes be abused, so they&#8217;ve decided to add a <code>create_pair</code> method to encourage people to only create a minimal number of test objects. We talked about the best way to test this against the various build strategies and shortly later committed <a href="https://github.com/thoughtbot/factory_girl/commit/b9e1dde7e8bb4497a711487641e751a310fdf996">b9e1dd</a>. A great start to the day!</p>

<p>Next up was the daily standup. It&#8217;s pretty fast-paced, with about 30 developers involved. Fridays are usually reserved for working on open source projects, or learning a new technology, kind of a &#8216;20% time&#8217;.</p>

<p>I then paired with <a href="https://twitter.com/joelquen">Joel Quenneville</a>, building a basic Ember.js app from scratch, without involving any Rails stuff. We had quite a few &#8220;Ok, this works, but it shouldn&#8217;t work!&#8221; moments, and overall we both discovered a few new things about Ember.</p>

<p>Lunch at Thoughtbot is catered in-office on Fridays, so I got to meet a few more of the team.</p>

<p>After lunch I paired a bit more with Joel, adding ember-data, and then with <a href="https://twitter.com/TonyD256">Tony DiPasquale</a> on some iOS code for <a href="https://github.com/tonyd256/TDAudioPlayer">TDAudioPlayer</a>. It was interesting to see all the improvements to Objective-C and XCode since I last used it (I tend to use RubyMotion).</p>

<p>Friday afternoons at Thoughtbot ends with a round-table tech discussion. The topic this week was Rails engines, which I&#8217;ve used but aren&#8217;t deeply familiar with, but it was interesting to hear the lively argued discussion.</p>

<p>I met <a href="https://twitter.com/r00k">Ben Orenstein</a> who I knew of through the Giant Robots podcast and his conferences talks.</p>

<p>The day finished with drinks and dinner at some local bars.</p>

<p>Overall, a great start to my tour! Thanks to everyone at Thoughtbot for being so welcoming.</p>
</div>

  <footer>
    
    <p><a class="comments-link" href="/2013/11/02/thoughtbot-boston/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2013/10/31/the-coding-tour-begins/">The Coding Tour Begins</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2013-10-31T23:45:00-05:00" pubdate data-updated="true">Oct 31<span>st</span>, 2013</time>
         &bull; <a rel="bookmark" href="/2013/10/31/the-coding-tour-begins/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>So after the past several months of planning, and a few hectic weeks of moving out out of my apartment, I&#8217;ve at last set off on my World Coding Tour. I&#8217;m writing this from a hotel room in Boston, where I&#8217;ll be visiting <a href="http://thoughtbot.com/">ThoughtBot</a> tomorrow.</p>

<p>I&#8217;ve had an awesome and enthusiastic response to the tour, and I&#8217;m grateful to everyone who&#8217;s helped spread the word, especially Corey Haines and Avdi Grimm, who helped to spread the word. I&#8217;ve had offers from all over the US. Rather than try to arrange every date up front, I&#8217;m going to schedule as I go. RubyConf is coming up this weekend, so that should be a good opportunity to find some companies to visit.</p>
</div>

  <footer>
    
    <p><a class="comments-link" href="/2013/10/31/the-coding-tour-begins/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2013/09/17/promoting-my-coding-world-tour/">Promoting My Coding Tour</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2013-09-17T22:51:00-05:00" pubdate data-updated="true">Sep 17<span>th</span>, 2013</time>
         &bull; <a rel="bookmark" href="/2013/09/17/promoting-my-coding-world-tour/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><h2>Previous Post: <a href="http://blog.andywaite.com/2013/09/14/coding-world-tour/">My Coding World Tour</a></h2>

<p>I announced plans for my Coding World Tour in a <a href="http://blog.andywaite.com/2013/09/14/coding-world-tour/">previous blog post</a>. The next challenge is to make sure people know about it.</p>

<p>Other than a couple of posts on Twitter and a share on LinkedIn, I haven&#8217;t yet done much promotion. This post describes my next steps for spreading the word.</p>

<h2>Personal Network</h2>

<p>I know a handful of people in some of the cities on my list, so I&#8217;ll be asking them to share my post with their local contacts.</p>

<h2> Regional User Groups</h2>

<p>Every city I plan to visit has a least one Ruby or Rails user group. I think these will probably be my best bet for finding coding opportunities:</p>

<ul>
<li>New York City: <a href="http://www.meetup.com/NYC-rb/">NYC.rb</a></li>
<li>Boston: <a href="http://bostonrb.org/">Boston Ruby Group</a></li>
<li>Chicago: <a href="http://www.chicagoruby.org/">ChicagoRuby</a></li>
<li>Seattle: <a href="http://www.seattlerb.org/">Seattle.rb</a></li>
<li>Portland: <a href="http://pdxruby.org/">Portland Ruby Brigade</a></li>
<li>Atlanta: <a href="http://www.atlrug.com/">Atlanta Ruby Users Group</a></li>
<li>Dallas: <a href="http://www.dallasrb.org/">Dallas Ruby Brigade</a></li>
<li>Austin <a href="http://austinonrails.org/">Auston On Rails</a>, <a href="http://austinrb.org/">Austin.rb</a></li>
<li>Toronto: <a href="http://www.meetup.com/torontoruby/">Toronto Ruby Brigade</a>, <a href="https://groups.google.com/forum/#!forum/ruby-toronto">ruby-toronto</a></li>
<li>San Francisco: <a href="http://www.meetup.com/sfruby/">San Francisco Ruby Meetup Group</a>, <a href="http://www.meetup.com/SFRails/">SF Rails</a></li>
</ul>


<p>It might seem wrong to focus on Ruby, but it has an incredible community. Also, many Ruby developers are polyglot programmers, so it may lead to a chance of exploring other languages.</p>

<h2>Ruby Forums</h2>

<p>These forums are full of enthusiastic developers:</p>

<ul>
<li><a href="http://parley.rubyrogues.com/">Ruby Rogues Parley</a></li>
<li>ThoughtBot Prime forum</li>
</ul>


<h2>Individual Companies</h2>

<p>There are a number of companies I admire who I&#8217;d like to spend a few days with, so I may approach them directly, but I&#8217;m going to hold off and see what offers I get first.</p>

<h2>Other Publications</h2>

<p>These would be harder to get a mention on, but would be great publicity:</p>

<ul>
<li><a href="http://ruby5.envylabs.com/">Ruby5 podcast</a></li>
<li><a href="http://rubyrogues.com/">RubyRogues podcast</a></li>
<li><a href="http://rubyweekly.com/">RubyWeekly</a></li>
</ul>

</div>

  <footer>
    
    <p><a class="comments-link" href="/2013/09/17/promoting-my-coding-world-tour/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2013/09/14/coding-world-tour/">My Coding World Tour</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2013-09-14T16:25:00-05:00" pubdate data-updated="true">Sep 14<span>th</span>, 2013</time>
         &bull; <a rel="bookmark" href="/2013/09/14/coding-world-tour/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>In the culinary world, a <a href="http://en.wikipedia.org/wiki/Stage_%28cooking%29"><em>stage</em></a> (pronounced <em>stazhje</em>, from the French <em>stagiaire</em>) is an unpaid internship when a cook or chef works briefly, for free, in another chef&#8217;s kitchen to learn and be exposed to new techniques and cuisines.</p>

<p>To improve as a developer, I want to try this approach in the software world. At the end of October I will be leaving London, my home for the past six years, buying a Round-The-World plane ticket, and visiting North America, South East Asia, and Europe. During that time, I&#8217;ll be seeking out opportunities for a number of short coding internships at development companies.</p>

<h2>Why I&#8217;m Doing This</h2>

<blockquote><p>&#8220;Every day, work to refine the skills you have and to add new tools to your repertoire. Over the years, you&#8217;ll be amazed at how your experience has blossomed and your skills have grown.&#8221; &#8211; The Pragmatic Programmer, Andrew Hunt and Dave Thomas</p>

<p>&#8220;Be the worst guy in every band you’re in. The people around you affect your own performance. Choose your crowd wisely.&#8221; &#8211; The Passionate Programmer, Chad Fowler</p></blockquote>

<p>I want this experience to give me new perspectives on being a developer, to discover new concepts and techniques, and most importantly improve by <a href="http://codeulate.com/2013/08/how-to-improve-as-a-programmer">learning from others</a>.</p>

<p>For the past few years I&#8217;ve worked as a contractor for a variety of companies in London, and I found that one of the most interesting aspects is the initial period of joining a team and discovering how each organisation approaches development differently. This phase is always when I learn most and re-think my opinions on the best way to build software. There&#8217;s always a suprising amount of innovation under the covers.</p>

<p>There&#8217;s also, of course, the benefits of travel &#8211; discovering new cities, meeting new people, and building my professional network.</p>

<p>I&#8217;ve been inspired by reading about <a href="http://programmingtour.blogspot.com">Corey Haines&#8217; Journeyman pair-programming tour</a>, although my travels won&#8217;t be quite as extensive as I&#8217;ll be alternating with working on my own projects while travelling.</p>

<h2>What You Get Out Of It</h2>

<p>Probably the biggest benefit is a fresh set of eyes on your team&#8217;s code and your process. So it&#8217;s like <a href="http://www.pairprogramwith.me/">#pairwithme</a> but in real life!</p>

<p>I&#8217;ve worked on many types of apps including mobile, APIs, e-commerce, social networks and gaming, each of which have taught me useful lessons that I can share.</p>

<p>I will be aiming to blog about the companies I visit (if given consent), so it&#8217;s also an opportunity to raise the profile of your workplace to an audience of developers.</p>

<h2>About Me</h2>

<p>I&#8217;ve been a contract Ruby developer for the past three years, with a bit of JavaScript and iOS development too. I would put my skill level at between mid-level and senior. I&#8217;m a proponent of test-driven development, simple design, clean code, refactoring and pair programming.</p>

<p>My most popular open source project is <a href="https://github.com/andyw8/rubymotion_generators">RubyMotion Generators</a>, as featured in some episodes of <a href="http://motioncasts.tv/">motioncasts.tv</a>. I&#8217;m hoping to get <a href="https://github.com/rails/rails/pull/10471">my first Rails contribution</a> accepted soon!</p>

<p>My side-projects include:</p>

<ul>
<li><a href="https://itunes.apple.com/gb/app/streetfood-london/id589405547?mt=8">StreetFood London</a></li>
<li><a href="http://techradar.io">techradar.io</a> (under development)</li>
<li>Confreaks iOS app (under development)</li>
</ul>


<p>I also coach a few aspiring developers via <a href="http://www.railsmentors.org">RailsMentors</a></p>

<p>Around the web:</p>

<ul>
<li><a href="http://blog.andywaite.com">blog.andywaite.com</a></li>
<li><a href="http://twitter.com/andyw8">twitter.com/andyw8</a></li>
<li><a href="http://stackoverflow.com/users/119822/andy-waite">StackOverflow profile</a></li>
<li><a href="http://github.com/andyw8">github.com/andyw8</a></li>
<li><a href="http://linkedin.andywaite.com">LinkedIn</a></li>
</ul>


<h2>The Details</h2>

<p>The duration of each position might be anywhere from one day to a week. I&#8217;m happy to work with people of different skill levels during each visit.</p>

<p>I&#8217;ll be starting off in North America and I have the following cities in my plan for November and December (dates and order to be confirmed).</p>

<ul>
<li>New York City</li>
<li>Boston</li>
<li>Miami (for <a href="http://rubyconf.org/">RubyConf</a>)</li>
<li>Chicago</li>
<li>Seattle / Portland</li>
<li>Atlanta</li>
<li>Dallas / Austin</li>
<li>San Francisco</li>
<li>Toronto</li>
</ul>


<p>I then plan to be in Asia in January-February and in Europe by March.</p>

<h2>Want To Get Involved?</h2>

<p>If you work at development company in one the above cities, and you are interested in having me visit during November or December, then please drop me an email at <strong><a href="&#109;&#97;&#x69;&#x6c;&#116;&#111;&#x3a;&#x74;&#x6f;&#x75;&#114;&#64;&#x61;&#110;&#100;&#x79;&#x77;&#x61;&#x69;&#x74;&#101;&#x2e;&#99;&#x6f;&#109;">&#116;&#x6f;&#117;&#x72;&#x40;&#x61;&#x6e;&#x64;&#x79;&#x77;&#x61;&#x69;&#116;&#101;&#46;&#x63;&#x6f;&#x6d;</a></strong>. I can organise my own accomodation and I&#8217;m not looking for any payment, but I wouldn&#8217;t say no to some post-work food or beers!</p>
</div>

  <footer>
    
    <p><a class="comments-link" href="/2013/09/14/coding-world-tour/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2013/02/28/rakefile-cucumber-rspec-jasmine/">Minimal Rakefile for RSpec, Cucumber and Jasmine</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2013-02-28T12:30:00-06:00" pubdate data-updated="true">Feb 28<span>th</span>, 2013</time>
         &bull; <a rel="bookmark" href="/2013/02/28/rakefile-cucumber-rspec-jasmine/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>I found I was repeatedly Googling for the Rakefile configuration to run various kinds of tests, so for my own reference, and hopefully someone else&#8217;s, here&#8217;s an example:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rspec/core/rake_task&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;cucumber/rake/task&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;guard/jasmine/task&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">RSpec</span><span class="o">::</span><span class="no">Core</span><span class="o">::</span><span class="no">RakeTask</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="no">Cucumber</span><span class="o">::</span><span class="no">Rake</span><span class="o">::</span><span class="no">Task</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="no">Guard</span><span class="o">::</span><span class="no">JasmineTask</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>
</span><span class='line'><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:spec</span><span class="p">,</span> <span class="ss">:cucumber</span><span class="p">,</span> <span class="s1">&#39;guard:jasmine&#39;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that you&#8217;ll need the <a href="" title="https://github.com/netzpirat/guard-jasmine">guard-jasmine</a> gem for the Jasmine task.</p>
</div>

  <footer>
    
    <p><a class="comments-link" href="/2013/02/28/rakefile-cucumber-rspec-jasmine/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2013/02/21/playing-with-rspec-fire/">Playing With (RSpec)-Fire</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2013-02-21T22:07:00-06:00" pubdate data-updated="true">Feb 21<span>st</span>, 2013</time>
         &bull; <a rel="bookmark" href="/2013/02/21/playing-with-rspec-fire/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>I&#8217;ve heard <a href="https://github.com/xaviershay/rspec-fire">rspec-fire</a> mentioned in a few talks by <a href="https://twitter.com/garybernhardt">Gary Bernhardt</a> as a way to keep test doubles in sync with their real classes. This prevents the risk of all the isolated tests passing but the actual app being broken, which is a common concern when doing <a href="http://www.growing-object-oriented-software.com/">GOOS</a>-style testing where all the collaborators are replaced by test doubles.</p>

<p>Paraphrasing from the rspec-fire README:</p>

<blockquote><p>rspec-fire only checks that the methods exist if the doubled class has already been loaded. No checking will happen when running the spec in isolation, but when run in the context of the full app (either as a full spec run or by explicitly preloading collaborators on the command line) a failure will be triggered if an invalid method is being stubbed.</p></blockquote>

<p>It took me a little time to get my head around how rspec-fire works, so I&#8217;ve written up a slightly extended example here.</p>

<p>I followed the instructions in the README and found <a href="http://stackoverflow.com/questions/15009603/rspec-fire-specs-passing-when-they-shouldnt/15010004#15010004">a small problem</a>, but within minutes <a href="https://twitter.com/myronmarston">@myronmarston</a> had fixed it.</p>

<p>Let&#8217;s start with the class that we want to test. The example in the rspec-fire README inherits from <code>Struct</code> to keep things concise, but for clarity let&#8217;s make it a normal class:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">notifier</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@notifier</span> <span class="o">=</span> <span class="n">notifier</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">suspend!</span>
</span><span class='line'>    <span class="vi">@notifier</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;suspended as&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can check out my code at <a href="https://github.com/andyw8/try-rspec-fire">https://github.com/andyw8/try-rspec-fire</a>.</p>

<p>Here&#8217;s what the spec for this class would look like, just using RSpec&#8217;s built-in support for test doubles:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="s1">&#39;#suspend!&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s1">&#39;sends a notification&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">notifier</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="s2">&quot;EmailNotifier&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">notifier</span><span class="o">.</span><span class="n">should_receive</span><span class="p">(</span><span class="ss">:notify</span><span class="p">)</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s2">&quot;suspended as&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">notifier</span><span class="p">)</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">suspend!</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>(Keep in mind that in RSpec, <code>mock</code> and <code>stub</code> are simply aliases for <code>double</code>)</p>

<p>Our <code>EmailNotifier</code> would look like this:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">EmailNotifier</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</span><span class='line'>    <span class="c1"># ...</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Run <code>rspec spec/user_spec.rb</code> and this should pass.</p>

<p>Now let&#8217;s say the requirements change. We want to add an option to specify whether the notification should be in plain text or html. The spec becomes:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">User</span><span class="p">,</span> <span class="s1">&#39;#suspend!&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s1">&#39;sends a notification in the appropriate format&#39;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">notifier</span> <span class="o">=</span> <span class="n">double</span><span class="p">(</span><span class="s2">&quot;EmailNotifier&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">format</span> <span class="o">=</span> <span class="n">stub</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">notifier</span><span class="o">.</span><span class="n">should_receive</span><span class="p">(</span><span class="ss">:notify</span><span class="p">)</span><span class="o">.</span><span class="n">with</span><span class="p">(</span><span class="s2">&quot;suspended as&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">notifier</span><span class="p">)</span>
</span><span class='line'>    <span class="n">user</span><span class="o">.</span><span class="n">suspend!</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>To make this spec pass, we change the user class so that <code>#suspend!</code> takes a <code>format</code> parameter:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">notifier</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@notifier</span> <span class="o">=</span> <span class="n">notifier</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">suspend!</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@notifier</span><span class="o">.</span><span class="n">notify</span><span class="p">(</span><span class="s2">&quot;suspended as&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The spec now passes. However, if we tried to use this in a real app it would be broken, because we haven&#8217;t updated our <code>EmailNotifier</code> class.</p>

<p>This is the problem that spec-fire solves.</p>

<p>We first need to add a few lines to <code>spec_helper.rb</code>:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rspec/fire&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Fire</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And we need one small change to the spec, changing <code>double("EmailNotifier")</code> to <code>fire_double("EmailNotifier")</code>.</p>

<p>We then re-run the spec, but this time we preload the collaborator:</p>

<pre><code>$ rspec -I lib -r email_notifier.rb spec/user_spec.rb
</code></pre>

<p>That command looks slightly cryptic. Let&#8217;s check what the RSpec docs say:</p>

<pre><code>Usage: rspec [options] [files or directories]

    -I PATH                          Specify PATH to add to $LOAD_PATH (may be used more than once).
    -r, --require PATH               Require a file.

User#suspend!
  sends a notification (FAILED - 1)
</code></pre>

<p>We&#8217;re telling RSpec to require the real <code>EmailNotifier</code> class. When we call <code>fire_double</code>, it sees that the real class is loaded, uses that instead of the test double, and so triggers a failure:</p>

<pre><code>1) User#suspend! sends a notification in html
   Failure/Error: notifier.should_receive(:notify).with("suspended as", :html)
     Wrong number of arguments for notify. Expected 1, got 2.
   # ./spec/user_spec.rb:9:in `block (2 levels) in &lt;top (required)&gt;'
</code></pre>

<p>Let&#8217;s fix <code>EmailNotifier</code>:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">EmailNotifier</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">notify</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
</span><span class='line'>    <span class="c1"># ...</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the specs will now pass when testing against the real <code>EmailNotifier</code>.</p>

<p>So why does this all matter?</p>

<p>When all the unit tests are passing, but the actual app is still broken, a common reaction is to add more integration and system tests as a &#8216;safety-net&#8217;. But these kind of tests tend to be brittle and slow to run.</p>

<p>We need both kinds of tests, but the vast majority of our test suite should be isolated unit tests.</p>

<p>In his talk <a href="http://pyvideo.org/video/631/fast-test-slow-test">Fast Test, Slow Test</a>, Gary Bernhardt suggests aiming for a ratio of 90/10 between unit and system tests, approaching 95/5 or even 99/1 as time goes on.</p>

<p>rspec-fire gives you greater confidence that the isolated tests&#8217; boundaries line up with the real system.</p>
</div>

  <footer>
    
    <p><a class="comments-link" href="/2013/02/21/playing-with-rspec-fire/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/12/23/exploring-concerns-for-rails-4/">Exploring Concerns for Rails 4</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-12-23T17:54:00-06:00" pubdate data-updated="true">Dec 23<span>rd</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/12/23/exploring-concerns-for-rails-4/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>A <a href="http://railscasts.com/episodes/398-service-objects">recent episode</a> of Railscasts Pro covered two approaches to splitting up a large Rails model – <strong>Concerns</strong> and <strong>Service Objects</strong>.</p>

<p>Concerns are supported by Rails 3 but will become more &#8216;official&#8217; in Rails 4. There&#8217;s some controversy about whether Concerns or Service Objects are the best approach. DHH is pushing Concerns but OO proponents tend to prefer Service Objects. I believe that both have their place and can be used together.</p>

<h2>An Example</h2>

<p>I began by looking at one of my ActiveRecord model classes to see what it made sense to extract. Initially I created seperate concerns for validations, assocations, and accessors, e.g.:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/models/trader.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Trader</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Accessors</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Validations</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Associations</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>But I then realised this was probably a bad idea:</p>

<ul>
<li>If I add new behaviour to Trader then I&#8217;d probably need to change more than one of these concerns.</li>
<li>It&#8217;s unlikely I&#8217;d be able to re-use any of those concerns for another model.</li>
</ul>


<p>So instead, I tried to group the code into &#8216;topics&#8217; and came up with the following:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/models/trader.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Trader</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">BasicInfo</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">FriendlyURL</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Location</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">OpeningHours</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Schedule</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Permissions</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In general, I believe a concern should be named after a domain concept (which I think is true for all of the above, except perhaps FriendlyURL).</p>

<p>Let&#8217;s look at the Schedule concern as an example:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/models/concerns/trader/schedule.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Trader</span>
</span><span class='line'>  <span class="k">module</span> <span class="nn">Schedule</span>
</span><span class='line'>    <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">included</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">attr_accessible</span> <span class="ss">:market_days_ids</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">has_many</span> <span class="ss">:appearances</span>
</span><span class='line'>      <span class="n">has_many</span> <span class="ss">:market_days</span><span class="p">,</span> <span class="ss">:through</span> <span class="o">=&gt;</span> <span class="ss">:appearances</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">open?</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">closed?</span>
</span><span class='line'>      <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>As shown, it can include a mix of validations, accessibilty, associations, as well as the plain methods. This is a much better way of grouping related functionality.</p>

<h2>Sharing Concerns</h2>

<p>One thing that wasn&#8217;t clear from the documentation and other articles I&#8217;ve seen is how a concern can be shared amongst multiple models. Let&#8217;s say you have two concerns with the same name:</p>

<ul>
<li>app/models/concerns/schedule.rb</li>
<li>app/models/concerns/trader/schedule.rb</li>
</ul>


<p>and the following model:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/models/trader.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Trader</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Schedule</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>In this case, the concern in <code>app/models/concerns/trader/schedule.rb</code> would be used, and the other ignored.</p>

<p>However, if that concern was removed, the model would pick up the other concern. So a model will search in it&#8217;s own <code>concerns</code> directory first, and if the concern isn&#8217;t found there, it will look in the top-level concerns directory.</p>

<p>If you prefer a more explicit way of indicating a shared concern, you can namespace it:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># app/models/trader.rb</span>
</span><span class='line'><span class="k">class</span> <span class="nc">Trader</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Shared</span><span class="o">::</span><span class="no">Schedule</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># app/models/concerns/shared/schedule.rb</span>
</span><span class='line'><span class="k">module</span> <span class="nn">Shared::Schedule</span>
</span><span class='line'>  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I hope you find this useful.</p>
</div>

  <footer>
    
    <p><a class="comments-link" href="/2012/12/23/exploring-concerns-for-rails-4/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/12/05/zeus-cucumber-guard/">Using Zeus With Cucumber and Guard</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-12-05T14:13:00-06:00" pubdate data-updated="true">Dec 5<span>th</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/12/05/zeus-cucumber-guard/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p><a href="https://github.com/burke/zeus">Zeus</a> is rapidly overtaking <a href="https://github.com/sporkrb/spork">Spork</a> as the tool of choice to speed up running Cucumber integration tests against Rails apps.</p>

<p>I wanted to use Zeus alongside <a href="https://github.com/guard/guard">Guard</a> to provide a rapid feedback cycle when doing BDD. This ended up being quite fiddly to get working, and it seems not many people are doing this yet, so here I will describe my configuration.</p>

<p>These instructions are for Mac OS X 10.8. On other platforms you&#8217;ll probably need to pick different gems for notifications and filesystems events.</p>

<h2>Gemfile</h2>

<p>Zeus seems to be picky about which groups it loads gems from, depending on what command you&#8217;re running. The configuration below works for me, but may not be optimal:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># just an extract</span>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;guard&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.5.4&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;guard-cucumber&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.2.2&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;guard-rspec&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 2.3.0&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;rb-fsevent&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 0.9.2&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="ss">:development</span><span class="p">,</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 2.12.0&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 2.12.0&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;capybara-webkit&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 0.7.1&#39;</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;cucumber-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 1.1.0&#39;</span><span class="p">,</span> <span class="ss">:require</span> <span class="o">=&gt;</span> <span class="kp">false</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;terminal-notifier-guard&#39;</span> <span class="c1"># Mac OS X 10.8 only</span>
</span><span class='line'>  <span class="n">gem</span> <span class="s1">&#39;zeus&#39;</span><span class="p">,</span> <span class="s1">&#39;~&gt; 0.12.0&#39;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;ve specified versions to show which combination worked for me. As some of these gems need to interact closely with each other, you need to be careful when upgrading in order to keep them &#8216;in sync&#8217;.</p>

<p>Note that the Zeus gem is listed in the <code>:test</code> group, even though I&#8217;m not running Zeus through Bundler. I&#8217;m not entirely sure why it has to be here, but I get an error <em>zeus is not part of the bundle</em> when it&#8217;s not present.</p>

<h2>Guardfile</h2>

<p>My Guardfile is fairly standard. <a href="https://github.com/guard/guard-rspec">guard-rspec</a> already has support for Zeus, so all I had to do was enable <code>zeus</code> and disable <code>bundler</code>:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">guard</span> <span class="s1">&#39;rspec&#39;</span><span class="p">,</span> <span class="n">zeus</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="n">bundler</span><span class="p">:</span> <span class="kp">false</span> <span class="k">do</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://github.com/guard/guard-cucumber">guard-cucumber</a> doesn&#8217;t have built-in support for Zeus, but the <code>command_prefix</code> setting can be used instead:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">guard</span> <span class="s1">&#39;cucumber&#39;</span><span class="p">,</span> <span class="n">command_prefix</span><span class="p">:</span> <span class="s1">&#39;zeus&#39;</span><span class="p">,</span> <span class="n">bundler</span><span class="p">:</span> <span class="kp">false</span> <span class="k">do</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Booting Up</h2>

<p>Start Zeus without using Bunder:</p>

<pre><code>$ zeus start
</code></pre>

<p>Then start Guard via Bundler:</p>

<pre><code>$ bundle exec guard
</code></pre>

<p>Now you can start building!</p>
</div>

  <footer>
    
    <p><a class="comments-link" href="/2012/12/05/zeus-cucumber-guard/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
    










    <article >
      
  <header>
    <h1 class="entry-title">

<a href="/2012/08/22/tdd-triangulation-practice/">TDD Triangulation Practice</a>

</h1>

    
      <p class="meta">
        








  


<time datetime="2012-08-22T13:50:00-05:00" pubdate data-updated="true">Aug 22<span>nd</span>, 2012</time>
         &bull; <a rel="bookmark" href="/2012/08/22/tdd-triangulation-practice/">Permalink</a>
      </p>
    
  </header>

<div class="entry-content"><p>After attending <a href="http://www.codemanship.co.uk/tddworkshop.html">Jason Goreman&#8217;s Intensive TDD workshop</a>, I decided to have some practice at the triangulation aspect of Test-Driven Development. I strictly kept to the TDD mantra of:</p>

<ul>
<li><strong>Red</strong>: Write a failing test</li>
<li><strong>Green</strong>: Make the test pass with the simplest implementation possible</li>
<li><strong>Refactor</strong>: Remove duplication or improve the design</li>
<li><strong>Repeat</strong></li>
</ul>


<p>I based my effort on the <a href="http://koans.heroku.com/about_scoring_project">Scoring Project</a> from RubyKoans. This already includes some tests but I wrote mine from scratch.</p>

<p>To recap the rules:</p>

<ol>
<li>A set of three ones is 1000 points</li>
<li>A set of three numbers (other than ones) is worth 100 times the number. (e.g. three fives is 500 points).</li>
<li>A one (that is not part of a set of three) is worth 100 points.</li>
<li>A five (that is not part of a set of three) is worth 50 points.</li>
<li>Everything else is worth 0 points.</li>
</ol>


<p>I started with what seemed like the simplest test possible:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="s2">&quot;#score&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it</span> <span class="s2">&quot;is 0 for an empty list&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">score</span><span class="p">(</span><span class="o">[]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&#8217;s make it green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="mi">0</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, how do you decide what test to write next? It seems that rules 3 and 4 are dependent on rules 1 and 2, so let&#8217;s postpone those for later and write a failing test for rule 1:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 1000 for a set of three ones&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">1000</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sticking the rule of only writing the minimum code needed to pass the test:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">dice</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>    <span class="mi">1000</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="mi">0</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>A confession here: This is how I initially approached the problem, but I found I got stuck at a &#8216;deadlock&#8217; position where it wasn&#8217;t possible to make progress with small, simple refactorings. Looking at the set of rules from a distance, we can see this the end result is an accumulation of the scores from each rule. Therefore, having a series of branches for alternative conditions probably isn&#8217;t going to work.</p>

<p>Let&#8217;s refactor the code to this to give a better base to build upon:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Write another failing test for rule 1:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">it</span> <span class="s2">&quot;is 1000 for a set including three ones&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">score</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">1000</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make it green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span> <span class="o">||</span> <span class="n">dice</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>At this point we can see duplication starting to appear, so it&#8217;s time to refactor and generalise the solution:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now let&#8217;s write a failing test for rule 2:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 600 for a set of three sixes&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="o">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">600</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make it green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">600</span> <span class="k">if</span> <span class="n">dice</span> <span class="o">==</span> <span class="o">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Write another failing test for rule 2:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 600 for a set including three sixes&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="o">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=</span> <span class="mi">600</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make it green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">600</span> <span class="k">if</span> <span class="n">dice</span> <span class="o">==</span> <span class="o">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="o">]</span> <span class="o">||</span> <span class="n">dice</span> <span class="o">==</span> <span class="o">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Refactor to remove duplication:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">600</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Write another failing test for rule 2:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 200 for a set including three twos&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=</span> <span class="mi">200</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make it green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">600</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">200</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can see some duplication creeping in - we would need five lines to cover three twos up to three sixes, so let&#8217;s refactor to generalise:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="mi">2</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>We also need to consider the case of more than three of the same value:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 200 for a set including three twos&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=</span> <span class="mi">200</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>A simple change makes this green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
</span><span class='line'>  <span class="mi">2</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Let&#8217;s add a failing test for Rule 3:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 100 for a one (that is not part of a set of three)&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=</span> <span class="mi">100</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make it green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
</span><span class='line'>  <span class="mi">2</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And another failing test for Rule 3:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 200 for two ones (that are not part of a set of three)&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=</span> <span class="mi">200</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make it green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
</span><span class='line'>  <span class="mi">2</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">200</span> <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Another failing test:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 200 for a set including two ones (that are not part of a set of three)&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=</span> <span class="mi">200</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make it green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="mi">2</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">200</span> <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">200</span> <span class="k">if</span> <span class="n">score</span> <span class="o">==</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Refactor and generalise:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
</span><span class='line'>  <span class="mi">2</span><span class="o">.</span><span class="n">upto</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Which can be further improved:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">dice</span><span class="o">.</span><span class="n">uniq</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="k">next</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">1000</span> <span class="p">:</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Write a failing test for rule 4:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 100 for a set including two fives (that are not part of a set of three)&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="o">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">=</span> <span class="mi">100</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make it green:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">dice</span><span class="o">.</span><span class="n">uniq</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="k">next</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">1000</span> <span class="p">:</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now let&#8217;s consider the slightly tricker case of interdependent rules:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">it</span> <span class="s2">&quot;is 550 for a set including three fives along with a single five&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">score</span><span class="p">(</span><span class="o">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="mi">550</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The current implementation will give an incorrect answer of 700 because it&#8217;s counting the fives as a triple and then counting them again as single fives. We need to make sure they aren&#8217;t counted twice.</p>

<p>A simple way of doing that is to sort the array and then drop the first 3 values of the array:</p>

<figure class='code'><div class='highlight'><table><td class='gutter'><pre class='line-numbers'><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">score</span><span class="p">(</span><span class="n">dice</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="n">dice</span><span class="o">.</span><span class="n">sort!</span>
</span><span class='line'>  <span class="n">dice</span><span class="o">.</span><span class="n">uniq</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
</span><span class='line'>    <span class="k">next</span> <span class="k">if</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span>
</span><span class='line'>    <span class="n">total</span> <span class="o">+=</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">1000</span> <span class="p">:</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span>
</span><span class='line'>    <span class="n">dice</span> <span class="o">=</span> <span class="n">dice</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="n">total</span> <span class="o">+=</span> <span class="mi">50</span> <span class="o">*</span> <span class="n">dice</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;m happy with that final solution, and it also passes the RubyKoans tests.</p>

<h2>What I Learned</h2>

<p>Triangulation is a useful technique but doesn&#8217;t bypass the need for the analysis and thinking required to solve tricky problems. If you try to do it on &#8216;autopilot&#8217; you probably won&#8217;t succeed. The order you choose to write the tests, and the code you write early on can have a significant impact in how much effort is required discover to the algorithm.</p>
</div>

  <footer>
    
    <p><a class="comments-link" href="/2012/08/22/tdd-triangulation-practice/#disqus_thread">View comments &raquo;</a></p>
    
    
  </footer>


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/2/">&larr; Older</a>
    
    <a href="/archives">Blog Archives</a>
    
  </div>
</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/11/20/tablexi/">TableXI Chicago</a>
      </li>
    
      <li class="post">
        <a href="/2013/11/02/thoughtbot-boston/">thoughtbot, Boston</a>
      </li>
    
      <li class="post">
        <a href="/2013/10/31/the-coding-tour-begins/">The Coding Tour Begins</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/17/promoting-my-coding-world-tour/">Promoting my Coding Tour</a>
      </li>
    
      <li class="post">
        <a href="/2013/09/14/coding-world-tour/">My Coding World Tour</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>On GitHub</h1>
  <ul id="gh_repos" data-user="andyw8" data-count="5" data-skip="true">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a class="github-follow" href="https://github.com/andyw8">Follow @andyw8</a>
  
</section>



<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets" data-user="andyw8" data-count="4" data-replies="false">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
    <a href="//twitter.com/andyw8" class="twitter-follow-button" data-show-count="false">Follow @andyw8</a>
  
</section>


<section>
  <h1>StackOverflow</h1>
  <a href="http://stackoverflow.com/users/119822/andy-waite"><img src="http://stackoverflow.com/users/flair/119822.png" width="208" height="58" alt="profile for Andy Waite at Stack Overflow, Q&A for professional and enthusiast programmers" title="profile for Andy Waite at Stack Overflow, Q&A for professional and enthusiast programmers"></a>
</section>


  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Andy Waite -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'andywaite';
			var disqus_developer = '0';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






</body>
</html>
